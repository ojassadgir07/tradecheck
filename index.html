<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Check</title>


<!-- Apple Touch Icon for iOS -->
<link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">

<!-- Manifest for PWA -->
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#4caf50">

<style>
body { font-family: Arial, sans-serif; padding-top:80px; background:#f6f6f6; margin:0; text-align:center;}
header { position: fixed; top:0; left:0; width:100%; background:#4caf50; color:white; padding:15px; display:flex; align-items:center; justify-content:center; z-index:100; box-shadow:0 2px 6px rgba(0,0,0,0.2);}
header h1 { margin:0; font-size:1.5em; flex:1;}
#backArrow { font-size:1.8em; cursor:pointer; display:none; margin-right:auto;}
h2,h3 { margin-bottom:20px; }
.button-row { display:flex; justify-content:center; gap:12px; margin-bottom:12px; }
.menu-btn { flex:1; max-width:180px; padding:18px 0; font-size:1.2em; color:white; border:none; border-radius:12px; cursor:pointer;
           background: rgba(255,255,255,0.1); backdrop-filter: blur(8px);
           box-shadow: 0 4px 15px rgba(0,0,0,0.2), inset 0 -2px 0 rgba(255,255,255,0.2);
           transition: transform 0.2s ease, box-shadow 0.2s ease; }
.menu-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.25), inset 0 -2px 0 rgba(255,255,255,0.25); }
.green-btn { background-color: rgba(76,175,80,0.6); }
.red-btn   { background-color: rgba(244,67,54,0.6); }
.hidden { display:none; }
table { width:90%; max-width:600px; margin:15px auto 25px; border-collapse:collapse; background:white; border-radius:6px; overflow:hidden; box-shadow:0 0 4px rgba(0,0,0,0.1);}
th, td { padding:12px 10px; border:1px solid #ddd; text-align:center; }
input[type="checkbox"] { width:28px; height:28px; transform:scale(1.3); cursor:pointer; }
.row-true { background-color:#b7e1b0; }
.amber-bg { background:#FFC107 !important; color:black; }
.home-title { font-size:1.3em; margin-bottom:10px; font-weight:bold; }
#popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); justify-content:center; align-items:center; z-index:1000; }
#popupContent { background:white; padding:30px 40px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.25); text-align:center; display:flex; flex-direction:column; align-items:center; max-width:90%; }
#popupIcon { font-size:3.4em; margin-bottom:15px; }
#popupText { font-size:1.4em; margin-bottom:20px; word-wrap: break-word; }
#popupContent button { padding:16px 32px; font-size:1.1em; border:none; border-radius:10px; background:#4caf50; color:white; cursor:pointer; }
@media (max-width:400px){ .menu-btn{ font-size:1em; padding:14px;} input[type="checkbox"]{width:24px; height:24px; transform:scale(1.2);} }
</style>
</head>
<body>

<header>
  <div id="backArrow">&#8592;</div>
  <h1>Trade Check</h1>
</header>

<div id="homeScreen">
  <div class="home-title">Bullish Trades</div>
  <div class="button-row">
    <button class="menu-btn green-btn" onclick="openSection('bullishEntry')">Bullish Entry</button>
    <button class="menu-btn red-btn" onclick="openSection('bullishExit')">Bullish Exit</button>
  </div>
  <div class="home-title">Bearish Trades</div>
  <div class="button-row">
    <button class="menu-btn red-btn" onclick="openSection('bearishEntry')">Bearish Entry</button>
    <button class="menu-btn green-btn" onclick="openSection('bearishExit')">Bearish Exit</button>
  </div>
  <div class="home-title">Rollover Trades</div>
  <div class="button-row">
    <button class="menu-btn green-btn" onclick="openRolloverSection('Bullish')">Bullish Rollover</button>
    <button class="menu-btn red-btn" onclick="openRolloverSection('Bearish')">Bearish Rollover</button>
  </div>
</div>

<div id="contentArea" class="hidden">
  <h2 id="sectionTitle"></h2>

  <!-- PRIMARY RULES tables -->
  <table id="primary-bullishEntry" class="hidden">
    <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
    <tr><td>RSI</td><td>Above 53 </td><td><input type="checkbox" class="bullish-entry"></td></tr>
    <tr><td>Price Close</td><td>Above 50 EMA </td><td><input type="checkbox" class="bullish-entry"></td></tr>
    <tr><td>Result</td><td></td><td class="result-cell"></td></tr>
  </table>

  <table id="primary-bearishEntry" class="hidden">
    <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
    <tr><td>RSI</td><td>Below 31 </td><td><input type="checkbox" class="bearish-entry"></td></tr>
    <tr><td>Price Close</td><td>Below 50 EMA </td><td><input type="checkbox" class="bearish-entry"></td></tr>
    <tr><td>Result</td><td></td><td class="result-cell"></td></tr>
  </table>

  <table id="primary-bullishExit" class="hidden">
    <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
    <tr><td>RSI</td><td>Below 31 </td><td><input type="checkbox" class="bullish-exit"></td></tr>
    <tr><td>Price Close</td><td>Below 50 EMA </td><td><input type="checkbox" class="bullish-exit"></td></tr>
    <tr><td>Result</td><td></td><td class="result-cell"></td></tr>
  </table>

  <table id="primary-bearishExit" class="hidden">
    <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
    <tr><td>RSI</td><td>Above 53 </td><td><input type="checkbox" class="bearish-exit"></td></tr>
    <tr><td>Price Close</td><td>Above 50 EMA </td><td><input type="checkbox" class="bearish-exit"></td></tr>
    <tr><td>Result</td><td></td><td class="result-cell"></td></tr>
  </table>

  <!-- SECONDARY RULES -->
  <div id="secondaryArea" class="hidden">
    <h3 id="secondaryHeader">Secondary Rules</h3>
    <table>
      <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
      <tr id="secTimeRow">
        <td>Time</td><td>10:16, 15:16, 15:30</td><td><input type="checkbox" class="sec-rule" id="secTime"></td>
      </tr>
      <tr id="secRsiRow" class="hidden">
        <td>RSI</td><td id="secRsiCond">--</td><td><input type="checkbox" class="sec-rule" id="secRsi"></td>
      </tr>
      <tr>
        <td id="secNoneCol1">None of the above</td>
        <td id="secNoneCol2">--</td>
        <td><input type="checkbox" class="sec-rule" id="secNone"></td>
      </tr>
    </table>
  </div>

  <!-- TRADE CHECK (only Entry) -->
  <div id="tradeCheckArea" class="hidden">
    <h3>Trade Check</h3>
    <table>
      <tr><th>Strikes</th><th>Condition</th><th>Check</th></tr>
      <tr><td>Sell Delta</td><td>10‑13 </td><td><input type="checkbox" class="strikes"></td></tr>
      <tr><td>Buy Delta</td><td>5‑7 </td><td><input type="checkbox" class="strikes"></td></tr>
      <tr><td>OTM</td><td>Above 500 </td><td><input type="checkbox" class="strikes"></td></tr>
      <tr><td>DTE</td><td>Above 14 </td><td><input type="checkbox" class="strikes"></td></tr>
    </table>
  </div>
</div>

<!-- Adding new section for Rollover -->
<div id="rolloverSection" class="hidden">
  <h2 id="rolloverTitle">Rollover</h2>

  <!-- PRIMARY RULES tables -->
  <table id="primary-rolloverBullish" class="hidden">
    <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
    <tr><td>Profit</td><td>Above 90%</td><td><input type="checkbox" class="rollover-bullish"></td></tr>
    <tr><td>RSI</td><td>Above 53</td><td><input type="checkbox" class="rollover-bullish"></td></tr>
    <tr><td>DTE</td><td>0-7</td><td><input type="checkbox" class="rollover-bullish"></td></tr>
    <tr><td>Result</td><td></td><td class="result-cell"></td></tr>
  </table>

  <table id="primary-rolloverBearish" class="hidden">
    <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
    <tr><td>Profit</td><td>Above 90%</td><td><input type="checkbox" class="rollover-bearish"></td></tr>
    <tr><td>RSI</td><td>Below 31</td><td><input type="checkbox" class="rollover-bearish"></td></tr>
    <tr><td>DTE</td><td>0-7</td><td><input type="checkbox" class="rollover-bearish"></td></tr>
    <tr><td>Result</td><td></td><td class="result-cell"></td></tr>
  </table>

  <!-- SECONDARY RULES -->
  <div id="secondaryRolloverArea" class="hidden">
    <h3 id="secondaryRolloverHeader">Secondary Rules</h3>
    <table>
      <tr><th>Rules</th><th>Condition</th><th>Check</th></tr>
      <tr>
        <td>DTE</td><td>More than 7</td><td><input type="checkbox" class="sec-rollover" id="secRolloverDTE"></td>
      </tr>
      <tr>
        <td>RSI</td><td id="secRolloverRSICond">Re-entry above 53</td><td><input type="checkbox" class="sec-rollover" id="secRolloverRSI"></td>
      </tr>
    </table>
  </div>
</div>

<!-- POPUP modal -->
<div id="popup">
  <div id="popupContent">
    <div id="popupIcon">&#10004;</div>
    <div id="popupText"></div>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<script>
// --- JS logic copied exactly from your previous working version ---
let currentSection="";
function openSection(type){
  currentSection=type;
  document.getElementById("homeScreen").classList.add("hidden");
  document.getElementById("contentArea").classList.remove("hidden");
  document.getElementById("backArrow").style.display="block";
  document.getElementById("sectionTitle").textContent = type.replace(/([A-Z])/g," $1").replace(/^./, str=>str.toUpperCase());
  document.querySelectorAll("[id^='primary-']").forEach(t=>t.classList.add("hidden"));
  document.getElementById("primary-"+type).classList.remove("hidden");
  document.getElementById("secondaryArea").classList.add("hidden");
  document.getElementById("tradeCheckArea").classList.add("hidden");
  clearAll();
}
function goBack(){
  document.getElementById("contentArea").classList.add("hidden");
  document.getElementById("homeScreen").classList.remove("hidden");
  document.getElementById("backArrow").style.display="none";
  clearAll();
}
document.getElementById("backArrow").addEventListener("click", goBack);
function clearAll(){
  document.querySelectorAll("input[type=checkbox]").forEach(cb=>cb.checked=false);
  document.querySelectorAll("tr").forEach(tr=>tr.classList.remove("row-true","amber-bg"));
  document.getElementById("secRsiRow").classList.add("hidden");
  document.getElementById("secRsiCond").textContent="--";
  document.getElementById("secNoneCol1").textContent="None of the above";
  document.getElementById("secNoneCol2").textContent="--";
  document.querySelectorAll(".result-cell").forEach(cell=>cell.textContent="");
}

function updateResult(cls){
  const boxes=document.querySelectorAll("."+cls);
  return boxes.length>0 && [...boxes].every(b=>b.checked);
}

function setupSecondaryRules(){
  const header=document.getElementById("secondaryHeader");
  const rsiCond=document.getElementById("secRsiCond");
  header.textContent="Secondary Rules";
  document.getElementById("secondaryArea").classList.remove("hidden");
  document.getElementById("secondaryArea").scrollIntoView({behavior:"smooth", block:"start"});
}

// Primary checkboxes
document.querySelectorAll("input[type=checkbox]").forEach(cb=>{
  cb.addEventListener("change", ()=>{ 
      updateAllResults(); 
  });
});

// Secondary rules
const secTime = document.getElementById("secTime");
const secRsiRow = document.getElementById("secRsiRow");
const secNoneCol1 = document.getElementById("secNoneCol1");
const secNoneCol2 = document.getElementById("secNoneCol2");

secTime.addEventListener("change", () => {
    const secRsi = document.getElementById("secRsi");
    if(secTime.checked){
        secRsiRow.classList.remove("hidden"); 
        secRsi.checked = false;
        secRsiRow.classList.remove("amber-bg");
        
        switch(currentSection){
            case "bullishEntry":
                secRsiRow.querySelector("td:first-child").textContent = "RSI";
                secRsiRow.querySelector("td:nth-child(2)").textContent = "Below 55 ";
                secNoneCol1.textContent = "RSI";
                secNoneCol2.textContent = "Above 55 ";
                break;
            case "bearishEntry":
                secRsiRow.querySelector("td:first-child").textContent = "RSI";
                secRsiRow.querySelector("td:nth-child(2)").textContent = "Above 29.5 ";
                secNoneCol1.textContent = "RSI";
                secNoneCol2.textContent = "Below 29.5 ";
                break;
            case "bullishExit":
                secRsiRow.querySelector("td:first-child").textContent = "RSI";
                secRsiRow.querySelector("td:nth-child(2)").textContent = "Above 29.5 ";
                secNoneCol1.textContent = "RSI";
                secNoneCol2.textContent = "Below 29.5 ";
                break;
            case "bearishExit":
                secRsiRow.querySelector("td:first-child").textContent = "RSI";
                secRsiRow.querySelector("td:nth-child(2)").textContent = "Below 55 ";
                secNoneCol1.textContent = "RSI";
                secNoneCol2.textContent = "Above 55 ";
                break;
            default:
                secNoneCol1.textContent = "RSI";
                secNoneCol2.textContent = "--";
        }
        secRsiRow.scrollIntoView({behavior:"smooth", block:"center"});
    } else {
        secRsiRow.classList.add("hidden"); 
        secRsi.checked = false;
        secRsiRow.classList.remove("amber-bg");
        secNoneCol1.textContent = "None of the above";
        secNoneCol2.textContent = "--";
    }
    updateSecondaryResults();
});

function updateSecondaryResults(){
  const secTimeChecked=document.getElementById("secTime").checked;
  const secRsiChecked=document.getElementById("secRsi").checked;
  const secNoneChecked=document.getElementById("secNone").checked;

  secTime.closest("tr").classList.remove("amber-bg");
  secRsiRow.classList.remove("amber-bg");

  if(secTimeChecked && secRsiChecked){
      secTime.closest("tr").classList.add("amber-bg");
      secRsiRow.classList.add("amber-bg");
      showPopup("WAIT for confirmation", false, "red");
  } else {
      if(secTimeChecked) secTime.closest("tr").classList.add("amber-bg");
      if(secRsiChecked) secRsiRow.classList.add("amber-bg");
  }

  if(secNoneChecked){
      secTime.closest("tr").classList.remove("amber-bg");
      secRsiRow.classList.remove("amber-bg");
      if(currentSection.includes("Entry")){
          document.getElementById("tradeCheckArea").classList.remove("hidden");
          document.getElementById("tradeCheckArea").scrollIntoView({behavior:"smooth", block:"start"});
      } else {
          showPopup("Good to Exit", false, "green");
      }
  }
}

function updateAllResults(){
  document.querySelectorAll("input[type=checkbox]").forEach(cb=>{
    if(cb.checked) cb.closest("tr").classList.add("row-true");
    else cb.closest("tr").classList.remove("row-true");
  });

  const primaryOk =
      (currentSection==="bullishEntry" && updateResult("bullish-entry")) ||
      (currentSection==="bearishEntry" && updateResult("bearish-entry")) ||
      (currentSection==="bullishExit" && updateResult("bullish-exit")) ||
      (currentSection==="bearishExit" && updateResult("bearish-exit"));

  if(primaryOk){
      document.querySelector("#primary-"+currentSection+" .result-cell").textContent="OK";
      document.querySelector("#primary-"+currentSection+" .result-cell").classList.add("row-true");
      setupSecondaryRules();
  }

  const tradeOk = updateResult("strikes");
  if(tradeOk && (currentSection.includes("Entry"))) showPopup("Good to Trade", false, "green");

  updateSecondaryResults();
}

function showPopup(msg, autoClose=false, color="green"){
  const popupIcon=document.getElementById("popupIcon");
  const popupText=document.getElementById("popupText");

  popupText.textContent=msg;
  popupText.style.color=color;
  if(color==="green"){
    popupIcon.innerHTML="&#10004;"; 
    popupIcon.style.color="green";
  } else if(color==="red"){
    popupIcon.innerHTML="&#10060;"; 
    popupIcon.style.color="red";
  }

  document.getElementById("popup").style.display="flex";
  if(autoClose) setTimeout(()=>document.getElementById("popup").style.display="none",2000);
}

function closePopup(){ 
  document.getElementById("popup").style.display="none"; 
  goBack(); 
  document.getElementById("contentArea").classList.add("hidden"); 
  document.getElementById("rolloverSection").classList.add("hidden"); 
  document.getElementById("secondaryArea").classList.add("hidden"); 
  document.getElementById("secondaryRolloverArea").classList.add("hidden"); 
  document.getElementById("homeScreen").classList.remove("hidden"); 
}

// Adding rollover logic
function openRolloverSection(type){
  currentSection=type;
  document.getElementById("homeScreen").classList.add("hidden");
  document.getElementById("rolloverSection").classList.remove("hidden");
  document.getElementById("backArrow").style.display="block";
  document.getElementById("rolloverTitle").textContent = type.replace(/([A-Z])/g," $1").replace(/^./, str=>str.toUpperCase());
  document.querySelectorAll("[id^='primary-rollover']").forEach(t=>t.classList.add("hidden"));
  document.getElementById("primary-rollover"+type).classList.remove("hidden");
  document.getElementById("secondaryRolloverArea").classList.add("hidden");
  clearAll();
}

function updateRolloverResults(cls){
  const boxes=document.querySelectorAll("."+cls);
  const allChecked = boxes.length>0 && [...boxes].every(b=>b.checked);

  if(allChecked){
    document.querySelector("#primary-rollover"+currentSection+" .result-cell").textContent="OK";
    document.querySelector("#primary-rollover"+currentSection+" .result-cell").classList.add("row-true");
    showPopup("Good for Rollover", false, "green");
  } else {
    const firstTwoChecked = boxes.length>2 && [...boxes].slice(0,2).every(b=>b.checked);
    if(firstTwoChecked){
      setupSecondaryRolloverRules();
    }
  }
}

function setupSecondaryRolloverRules(){
  const header=document.getElementById("secondaryRolloverHeader");
  header.textContent="Secondary Rules";
  document.getElementById("secondaryRolloverArea").classList.remove("hidden");
  document.getElementById("secondaryRolloverArea").scrollIntoView({behavior:"smooth", block:"start"});
}

function updateSecondaryRolloverResults(){
  const secDTEChecked=document.getElementById("secRolloverDTE").checked;
  const secRSIChecked=document.getElementById("secRolloverRSI").checked;

  if(secDTEChecked && secRSIChecked){
    showPopup("Good for Rollover", false, "green");
  }
}

// Event listeners for rollover checkboxes
const rolloverCheckboxes = document.querySelectorAll("input[type=checkbox]");
rolloverCheckboxes.forEach(cb=>{
  cb.addEventListener("change", ()=>{ 
      if(cb.classList.contains("rollover-bullish") || cb.classList.contains("rollover-bearish")){
        updateRolloverResults(cb.classList.contains("rollover-bullish") ? "rollover-bullish" : "rollover-bearish");
      } else if(cb.classList.contains("sec-rollover")){
        updateSecondaryRolloverResults();
      }
  });
});
</script>

</body>
</html>
